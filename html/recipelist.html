<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>레시피리스트 | 요리조리쿡</title>

<!-- 폰트 -->
<link rel="preconnect" href="https://fonts.gstatic.com">
<link
	href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap"
	rel="stylesheet">

<script
	src='https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js'></script>

<style>
@font-face {
	font-family: 'Wemakeprice-Bold';
	src:
		url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_20-10-21@1.0/Wemakeprice-Bold.woff')
		format('woff');
	font-weight: normal;
	font-style: normal;
}

@font-face {
	font-family: 'Wemakeprice-Regular';
	src:
		url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_20-10-21@1.0/Wemakeprice-Regular.woff')
		format('woff');
	font-weight: normal;
	font-style: normal;
}

section {
	width: 1300px;
	margin: 30px auto;
	font-family: 'Noto Sans KR', sans-serif;
}

.top {
	width: 1300px;
	margin: 0px auto;
}

.title {
	text-align: center;
	padding: 50px 10px 10px 10px;
	height: 160px;
	background-image: url("../images/web/back3.jpg");
	background-position: center;
	font-size: 27px;
	font-weight: bold;
}
/* 카테고리 : 한식, 양식, 일식, 중식 */
.category {
	margin: 20px 10px;
	padding: 17px;
	border-radius: 10px;
	border-style: none;
	background-color: rgba(224, 224, 224, 0.7);
	font-size: 14px;
}

.category:focus {
	border: none;
	outline: none;
}

.category:hover {
	background-color: #55A72B;
	color: white;
}

.category.on {
	background-color: #55A72B;
	color: white;
}

/*옵션선택*/
#recipe_ingre {
	width: 130px;
	height: 33px;
	margin: 0 auto;
	border-radius: 2px;
}

#text {
	width: 250px;
	height: 29px;
	margin: auto;
	text-align: center;
	border-radius: 2px;
}
/* 검색버튼 */
#submit {
	background-color: #55A72B;
	color: white;
	border: none;
	outline: none;
	font-size: 15px;
	width: 100px;
	height: 32px;
	border-radius: 5px;
}

/*검색 결과*/
#search {
	margin-top: 60px;
	margin-left: 53px;
	font-size: 25px;
	font-weight: bold;
}

#searchlist {
	margin: 30px;
	display: inline-block;
}
/* #양식#30분 */
.ex {
	font-size: 16px;
	margin: 3px;
	font-weight: bold;
	display: inline-block;
}

.button {
	font-weight: bold;
	font-size: 15px;
	width: 150px;
	height: 45px;
	margin: 10px;
	margin-left: 0px;
	background: #55A72B;
	color: white;
	border-radius: 10px;
}

.box {
	border-radius: 8px;
	border: solid 2px #36313138;
	outline: none;
}

input {
	cursor: pointer;
	font-family: 'Noto Sans KR', sans-serif;
}

header .recipe_list {
	color: #FC6636;
	font-weight: bold;
}
</style>
<script>

//$(function() {


//	});

/*카테고리별로 리스트보여주기*/
function listcategory(data, name) { //name은 myrecipe
	console.log(data);

	$("." + name + " .items .item").each(function(index, element){
		if(index == 0){
			$(element).css("display", "inline-block");
		}else{
			$(element).remove();
		}
	});
	var org = $("." + name + " .items .item");  //$(".myrecipe  .items .item")
	
	
	if (data.status == -1) {
		return false;
	} else {
		$("#search>span").html(data.list.length);
		var i = 0;
		var loginInfo = data.loginInfo;
		$(data.list).each(
				function(index, element) {
					
					var orgCopy = org.clone();
					//orgCopy.addClass("aaa");
					//레시피 관련
					orgCopy.find(".recipe_no").val(element.recipe_no);
					orgCopy.find(".recipe_img").attr('src',"../images/upload/" + element.recipe_img);
					orgCopy.find(".recipe_name").text(element.recipe_name);
					orgCopy.find(".recipe_time").text("#"+element.recipe_time);
					orgCopy.find(".recipe_category").text("#"+element.recipe_category);
					$(".items").append("<div class=\"listnum\" style=\"display:none;\" id =\""+i+"\"></div>");
					i++;
					
				var level;
					if(element.recipe_level==1){
						level =  "초보환영"
					}else if(element.recipe_level==2){
						level =  "보통"
					}else if(element.recipe_level==3){
						level =  "어려움"
					}								
					orgCopy.find(".recipe_level").text("#"+level);
					$(element.scraps).each(function(index, scrap){
						if(scrap.member.member_id == loginInfo){
							//alert(element.recipe_no + "스크랩됨!");
							orgCopy.find(".recipescrap_img").attr('src',"../images/web/mypage_clip.png");
							return;
						}
					});
					
					$("." + name + " .items").append(orgCopy);
				});
		$("." + name + " .items .item:nth-of-type(1)").hide();
		

	}
}

function fn_categoryClick(t, savecategory) {
		

	var tId = t.getAttribute("id");

	var findSavedTid = savecategory.indexOf(tId);
	if (findSavedTid > -1) {
		$("#" + tId).removeClass("on");
		savecategory.splice(findSavedTid, 1);
		console.log(findSavedTid);
	} else {
		$("#" + tId).addClass("on");
		savecategory.push(tId);
		console.log(findSavedTid);
	}
	console.log(JSON.stringify("savecategory"+ JSON.stringify(savecategory)));
	$.ajax({
		url : "../recipe/categorylist",
		method : "post",
		dataType: "json",
		contentType: 'application/json',
		data : 
			JSON.stringify(savecategory)
		,
		success : function(responseObj) {
			if (responseObj.status == 1) {
				console.log("data:"+responseObj);
				listcategory(responseObj, 'myrecipe');
			} else {
				alert(responseObj.msg);
			}
		},
		error : function(jqXHR) {
			alert("에러:" + jqXHR.status);
		}
	});

	console.log(savecategory);

}

function pageList(data){
	   /*레시피 목록*/
  /*   $.ajax({
    	url : '../recipe/listPage',           
    	method: 'post',
    	data : {"currentPage" : currentPage},
    	success:function(data){
    		
    		console.log(data.pgb);
    		 */
    		/* 페이징 */
    		
    		$('.paging li').empty();
    		// alert(data.pgb.startPage);
            if(data.pgb.startPage > 1){
    			$('.paging li:first-child').html('<span class="'+(data.pgb.startPage-1)+'">&#10094;&nbsp;&nbsp;&nbsp;</span>');
            }
    		
            $('.paging li:nth-child(2)').empty();        		
            for(let i= data.pgb.startPage; i<=data.pgb.endPage; i++){
    			$('.paging li:nth-child(2)').append('<span class ="'+i+'">'+i+'</span>&nbsp;&nbsp;&nbsp;</li>');            			
    			let pageNum = $('.paging li:nth-child(2) span:nth-child('+i+')').attr("class");
    			if(pageNum == data.pgb.currentPage){
    				$('.'+pageNum).css("font-weight", "bold");
    				$('.'+pageNum).css("cursor", "default");
    			}
            }
            
    		if(data.pgb.endPage < data.pgb.totalPage){
    			$('.paging li:last-child').html('<span class="'+(data.pgb.endPage+1)+'">&#10095;&nbsp;&nbsp;&nbsp;</span>');
    			
    		}
    		
            /* 페이징 이동 */
    		$(".paging>li>span").click(function(event){
    			
    			var classValue = $(event.target).html(); //.attr("class");
    			//alert("페이지이동 page = " + classValue);
    			//pageList(classValue);
    			$('.paging li').empty(); 
    			
    			
    			$.ajax({
    				url : '../recipe/list',
    				method : 'post',
    				data : {
    					"member_id" : sessionStorage.getItem("member_id"),
    					"currentPage" : classValue
    				},
    				success : function(data) {
    					console.log(data);
    					listcategory(data, 'myrecipe');
    					pageList(data);
    				},
    				error : function(jqueryXHR) {
    					alert(jQueryXHR);
    				}
    			});
    		});
           
    	/*  }*/
    /* }); */
}


$(function() {
	/*헤더, 푸터로드*/
	$("#header").load("header.html");
	$("#footer").load("footer.html");

	/*레서피 리스트 최신순으로 */
	$.ajax({
		url : '../recipe/list',
		method : 'post',
		data : {
			"member_id" : sessionStorage.getItem("member_id")
		},
		success : function(data) {
			//console.log(data);
			listcategory(data, 'myrecipe');			
		},
		error : function(jqueryXHR) {
			alert(jQueryXHR);
		}
	});

	/* 카테고리별 리스트 불러오기 */
	var savecategory = new Array();
	$("section>article>div.top>div>input.category").click(function(event){
		fn_categoryClick(event.target, savecategory);
	});


	$("#submit").click(function(){
		/*레서피 재료 부재료 양념 검색하여 보여주기 */
		$.ajax({
			url : '../recipe/list',
			method : 'post',
			data : "word="+ $(".ingretext").val(),
			
			success : function(data) {
				console.log(data);
				listcategory(data, 'myrecipe');
			},
			error : function(jqueryXHR) {
				alert(jQueryXHR);
			}
		});
		
	});
	
		
	/* 레시피 리스트에서 디테일로 넘어감 */	
	
	$("body > section > article:nth-child(2) > div > div.my.contents.first.myrecipe > div.items").on("click", "div.item", function(){
		var recipe_no = $(this).find("input[type='hidden']").val();
		var list_num = $(this).prev().attr("id");
		
		location.href="recipedetail.html?recipe_no="+recipe_no+":"+list_num;
	});

	

});
</script>
</head>
<body>
	<header id="header" style="position: relative;"> </header>

	<section>
		<!--레시피 리스트-->
		<article style="background-color: rgb(255, 248, 248);">
			<div class="top">
				<div class="title" style="font-family: 'Noto Sans KR', sans-serif;"></div>
				<!-- 카테고리 : 한식, 양식, 일식, 중식 -->
				<div style="margin-top: 27px; margin-left: 460px;">

					<input type="button" value="한식" class="category" id="1" 
					> 
					<input type="button"
						value="양식" class="category" id="2"> 
						<input type="button"
						value="중식" class="category" id="3"
						> 
						<input type="button"
						value="일식" class="category" id="4"> 
						<input type="button"
						value="퓨전" class="category" id="5">
					<!-- <input type="button" value="한식" class="category" id="1" 
						 onclick="fn_categroryClick(this);"
					> 
					<input type="button"
						value="양식" class="category" id="2"
						onclick="fn_categroryClick(this);"> <input type="button"
						value="중식" class="category" id="3"
						onclick="fn_categroryClick(this);"> <input type="button"
						value="일식" class="category" id="4"
						onclick="fn_categroryClick(this);"> <input type="button"
						value="퓨전" class="category" id="5"
						onclick="fn_categroryClick(this);"> <br> -->
				</div>

				<!-- 선택 : 재료/요리명, 부재료, 주재료, 양념 -->
				<div>
					<select id="recipe_ingre"
						style="margin-top: 22px; height: 37px; margin-left: 430px; margin-bottom: 50px; font-family: 'Noto Sans KR', sans-serif;"
						class="box">
						<option class="op" selected>재료/요리명</option>
						<option class="op">부재료</option>
						<option class="op">주재료</option>
					</select>

					<!-- 재료 및 부재료 입력 -->
					<input type="text" placeholder="입력하여 주세요" id="text" class="box ingretext"
						style="text-align: left; height: 37px;">

					<!-- 검색버튼 -->
					<input type="button" value="검색" id="submit"
						style="cursor: pointer; height: 36px;" class="button">
				</div>
			</div>
		</article>

		<!--검색결과-->
		<article>

			<div>
				<!--검색결과 조회-->
				<div id="search">검색결과 : <span>**</span> 개 조회</div>


				<div class="my contents first myrecipe" data-name="my">
					<div class="items">


						<div  class="item"
							style="display: inline-block; box-shadow: #ddd 1px 1px 6px 1px; margin: 25px 10px;">
							<div>
								<a href="recipedetail.html"> 
									<input type="hidden" value="" class="recipe_no"> 
									<img src="../images/upload/recipe_img1.png" alt="대표이미지" class="recipe_img" width="300px">
								</a>
							</div>
							<!--#30분 #양식-->
							<div class="txt" style="display: inline;">
								<div class="ex recipe_time">&nbsp;&nbsp;#30분&nbsp;&nbsp;</div>
								<div class="ex recipe_category">#양식&nbsp;&nbsp;</div>
								<div class="ex recipe_level">#초보환영&nbsp; </div>
								<img src="../images/web/mypage_clip.png"
										width="25px" class="recipescrap_img">
								<br>
								<!--레시피 제목-->
								<div class="ex recipe_name">&nbsp;&nbsp;미트볼스파게티</div>
								<br>
							</div>
						</div>

					</div>
				</div>


				<!--페이징-->
				<div >			     
			        <ul style="list-style-type:none; padding: 3px; cursor : pointer" margin : 0 auto; class ="paging" >
			        	<li style="display:inline-block;"></li>
			        	<li style="display:inline-block;"></li>
			        	<li style="display:inline-block;"></li>
			        </ul>
				</div>
		 	<script src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"></script>
		</article>
	</section>

	<footer id="footer"></footer>



</body>
</html>